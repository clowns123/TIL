# ì„±ëŠ¥ ê°œì„ 

> ì—…ë°ì´íŠ¸ ì¼ì: 2022.04.14
> 
- ì°¸ê³ ìë£Œ
    
    [Hooks API Reference - React](https://ko.reactjs.org/docs/hooks-reference.html#usememo)
    
    [React Top-Level API - React](https://reactjs.org/docs/react-api.html)
    
    [React.memo() í˜„ëª…í•˜ê²Œ ì‚¬ìš©í•˜ê¸°](https://ui.toast.com/weekly-pick/ko_20190731)
    
    [ì´ì œëŠ” ì‚¬ìš©í•´ë³´ì useMemo & useCallback](https://leehwarang.github.io/2020/05/02/useMemo&useCallback.html)
    
    [[React] useEffect dependency arrayì— objectì™€ array ë„£ê¸°](https://developer-alle.tistory.com/362)
    
    [When Using useMemo is A Really Bad Idea](https://blog.bitsrc.io/when-using-usememo-is-a-really-bad-idea-a2bdeb909812)
    
    [React ë Œë”ë§ ìµœì í™” (React.memo)](https://velog.io/@alstnsrl98/React-%EB%A0%8C%EB%8D%94%EB%A7%81-%EC%B5%9C%EC%A0%81%ED%99%94-React.memo)
    
    [TIL/13. ì»´í¬ë„ŒíŠ¸ ì„±ëŠ¥ ìµœì í™”.md at master Â· clowns123/TIL](https://github.com/clowns123/TIL/blob/master/react/%EA%B8%B0%EC%B4%88/13.%20%EC%BB%B4%ED%8F%AC%EB%84%8C%ED%8A%B8%20%EC%84%B1%EB%8A%A5%20%EC%B5%9C%EC%A0%81%ED%99%94.md)
    

## ğŸ’¡Â ë¦¬ë Œë”ë§ì´ ë°œìƒí•˜ëŠ” ìƒí™©

1. ë¶€ëª¨ ì»´í¬ë„ŒíŠ¸ê°€ ë¦¬ë Œë”ë§ë  ë•Œ
2. ìì‹ ì˜ stateê°€ ë³€ê²½ë  ë•Œ
3. ì „ë‹¬ë°›ì€ propsê°€ ë³€ê²½ë  ë•Œ
4. forceUpdate í•¨ìˆ˜ê°€ ì‹¤í–‰ë  ë•Œ

## ğŸ¤–Â ë©”ëª¨ì´ì œì´ì…˜ì´ë€?

 ë©”ëª¨ì´ì œì´ì…˜ì´ë€ ê¸°ì¡´ì˜ ìˆ˜í–‰í•œ ì—°ì‚°ì˜ ê²°ê³¼ê°’ì„ ì–´ë”˜ê°€ì— ì €ì¥í•´ë‘ê³ Â **ë™ì¼í•œ ì…ë ¥ì´ ë“¤ì–´ì˜¤ë©´**Â ì¬í™œìš©í•˜ëŠ” í”„ë¡œê·¸ë˜ë° ê¸°ë²•ì„ ë§í•œë‹¤. ì¦‰, ë©”ëª¨ì´ì œì´ì…˜ì„ ì ì ˆíˆ ì‚¬ìš©í•˜ë©´ ì¤‘ë³µ ì—°ì‚°ì„ í”¼í•  ìˆ˜ ìˆì–´ ë©”ëª¨ë¦¬ë¥¼ ì¡°ê¸ˆ ë” ì“°ë”ë¼ë„ ì„±ëŠ¥ ìµœì í™”ê°€ ê°€ëŠ¥í•˜ë‹¤.

## ğŸ“Â useMemo

```jsx
const memoizedValue = useMemo(() => { return returnValue }, [deps]);
```

- ë©”ëª¨ì´ì œì´ì…˜ëœ **ê°’**ì„ ë°˜í™˜
- `deps`ê°€ ë³€ê²½ì´ ë˜ë©´ í•¨ìˆ˜ ì‹¤í–‰ í›„ ê°’ì„ ë°˜í™˜
- ì‚¬ìš© ì˜ˆì‹œ
    
    ```jsx
    import React, { useState, useCallback, useMemo } from "react";
    
    export default function App() {
      const [ex, setEx] = useState(0);
      const [why, setWhy] = useState(0);
    
      // useMemo ì‚¬ìš©í•˜ê¸°
      const memoizedEx = useMemo(() => {
    		console.log(ex);
        return ex;
    	}, [ex]);
    
      // ë‘ ê°œì˜ ë²„íŠ¼ì„ ì„¤ì •í–ˆë‹¤. Xë²„íŠ¼ë§Œì´ exë¥¼ ë³€í™”ì‹œí‚¨ë‹¤.
      return (
        <>
          <button onClick={() => setEx((curr) => (curr + 1))}>X</button>
          <button onClick={() => setWhy((curr2) => (curr2 + 1))}>Y</button>
        </>
      );
    }
    ```
    
    â‡’ exê°’ì´ ë³€ê²½ë  ë•Œë§Œ ì½˜ì†”ì´ ì°íˆê²Œ ë¨
    

## ğŸ—£Â useCallback

```jsx
useCallback(fn, [deps]);
```

- ë©”ëª¨ì´ì œì´ì…˜ëœ **í•¨ìˆ˜**ë¥¼ ë°˜í™˜
- `useMemo(() => fn, [deps])`ì™€ ê°™ì€ ë™ì‘
- ì‚¬ìš© ì˜ˆì‹œ
    
    ```jsx
    import React, { useState, useCallback, useMemo } from "react";
    
    export default function App() {
      const [ex, setEx] = useState(0);
      const [why, setWhy] = useState(0);
    
      // useCallback ì´ () => {console.log(why)} ë¼ëŠ” í•¨ìˆ˜ë¥¼ ë°˜í™˜í•œë‹¤.
      const useCallbackReturn = useCallback(() => {console.log(why)}, [ex]);
    
      // useCallback ì´ ë‹´ê²¨ìˆëŠ” í•¨ìˆ˜ë¥¼ ì‹¤í–‰
      useCallbackReturn()
    
      return (
        <>
          <button onClick={() => setEx((curr) => (curr + 1))}>X</button>
          <button onClick={() => setWhy((curr2) => (curr2 + 1))}>Y</button>
        </>
      );
    }
    ```
    
    - `useCallback`ì˜ ì§„í–‰ ìˆœì„œ
        1. ì²˜ìŒ ì»´í¬ë„ŒíŠ¸ê°€ ì‹œì‘ëì„ ë•Œ
        2. `ex`ê°€ ë³€í•  ë•Œ
    
    [useCallback](https://codesandbox.io/s/usecallback-51nnby?file=/src/App.js:469-475)
    
    â–² `Y`ë¥¼ 5ë²ˆ ëˆŒëŸ¬ë„ ì½˜ì†”ì—ëŠ” 0ì´ ëœ¨ì§€ë§Œ, `X`ë¥¼ í´ë¦­í•˜ë©´ 5ê°€ ì •ìƒì ìœ¼ë¡œ ëœ¨ëŠ” ê²ƒì„ í™•ì¸
    
    â‡’ ì¦‰, `deps`ê°€ ë³€í•´ì•¼ í•¨ìˆ˜ ì»´í¬ë„ŒíŠ¸ì™€ ìƒíƒœê°’ì„ ê³µìœ í•˜ëŠ” ê²ƒ
    

## âœï¸Â React.memo()

```jsx
React.memo(Component, callback);
```

- ì´ì „ `props`ì™€ í˜„ì¬ `props`ë¥¼ ì–•ì€ ë¹„êµí•´ ê°™ì„ ê²½ìš°, í•´ë‹¹ ì»´í¬ë„ŒíŠ¸ ì—…ë°ì´íŠ¸ ë°©ì§€
- ì½œë°±í•¨ìˆ˜ì—ì„œ ë¹„êµ ì—°ì‚°ì´ ê°€ëŠ¥
- ì‚¬ìš© ì˜ˆì‹œ
    
    ```jsx
    const Comp = (props) => {
    	return <div> { props.isAlone ? <span>í˜¼ì</span> : <span>ë‹¤ìˆ˜</span> } </div>
    }
    
    /* ì½œë°±í•¨ìˆ˜ì—ì„œ ë¹„êµ ì—°ì‚° */
    const MemoizedComp = React.memo(Comp, (prev, next) => {
    	if (prev.isAlone === next.isAlone) return true;
     	else return false;
    });
    
    export default MemoizedComp;
    ```
    
    â‡’ ì½œë°±í•¨ìˆ˜ì—ì„œ trueë¥¼ ë¦¬í„´í–ˆì„ ê²½ìš°, ë¦¬ë Œë”ë§ ë°©ì§€
    

## ğŸ¤”Â ì–¸ì œ ì‚¬ìš©í•´ì•¼í• ê¹Œ?

- ì°¸ê³ ìë£Œ
    
    [React.memo() í˜„ëª…í•˜ê²Œ ì‚¬ìš©í•˜ê¸°](https://ui.toast.com/weekly-pick/ko_20190731)
    
    [When Using useMemo is A Really Bad Idea](https://blog.bitsrc.io/when-using-usememo-is-a-really-bad-idea-a2bdeb909812)
    

<aside>
ğŸ’¡ ì„±ëŠ¥ ê°œì„ ì„ ëª©ì ìœ¼ë¡œ ì‚¬ìš©í•´ì•¼í•œë‹¤.

</aside>

- ì´ëŸ´ ë•ŒëŠ” ì‚¬ìš©í•˜ì
    - ë¶ˆí•„ìš”í•œ ì¬ì—°ì‚°, ë¦¬ë Œë”ë§ì´ ìì£¼ ì¼ì–´ë‚  ë•Œ
    - `React.memo`ë¥¼ ì´ìš©í•  ë•Œ `props`ë¡œ ë„˜ê²¨ì£¼ëŠ” í•¨ìˆ˜ë‚˜ ê°’
        - í•¨ìˆ˜ëŠ” `useCallback`, ê°’ì€ `useMemo(Object, Array ë“± ë„˜ê²¨ì£¼ëŠ” ê°’ì´ reference valueì¼ ë•Œ)`ë¥¼ ì‚¬ìš©í•´ì•¼í•¨
            
            â†’ ë¦¬ë Œë”ë§ë  ë•Œë§ˆë‹¤ í•´ë‹¹ í•¨ìˆ˜, ê°’ì´ ì¬ì„ ì–¸ë˜ì–´ ìì‹ ì»´í¬ë„ŒíŠ¸ëŠ” `props`ê°€ ë‹¬ë¼ì¡Œë‹¤ê³  ì¸ì‹í•˜ê¸° ë•Œë¬¸
            
- ì´ëŸ´ ë•ŒëŠ” ì‚¬ìš©ì„ ë‹¤ì‹œ í•œ ë²ˆ ìƒê°í•´ë³´ì
    - ë¹„ì‹¼ ì—°ì‚°ì´ ì•„ë‹Œ ê²½ìš°
        
        â†’ ë¹„ì‹¼ ì—°ì‚°: `Data Fetching` ë“±
        
    - ëŒ€ë¶€ë¶„ì˜ ê²½ìš°ì—ì„œ ì›ì‹œê°’ì€ ê·¸ëƒ¥ ê³„ì‚°í•˜ëŠ” ê²ƒì´ `useMemo`ë¥¼ ì ìš©í•˜ëŠ” ê²ƒë³´ë‹¤ ë©”ëª¨ë¦¬ì†Œëª¨ê°€ ì ìŒ
    - `useState`ì˜ ì´ˆê¸°ê°’ì—ëŠ” ì‚¬ìš©í•˜ì§€ ì•Šì•„ë„ ë¨
        
        â†’ ì»´í¬ë„ŒíŠ¸ê°€ ì–¸ë§ˆìš´íŠ¸ë  ë•Œê¹Œì§€ ì¬ì—°ì‚°í•˜ì§€ ì•Šê¸° ë•Œë¬¸
        

## â“Â í€´ì¦ˆ

> 1.   `recoil/atom/userList User[]`Â ë°©ì‹ìœ¼ë¡œ ì‚¬ìš©ì ì •ë³´ë¥¼ ë‹¤ë£¨ê³  ìˆë‹¤.
> 
> 
> 2.  `isAlone`Â ì´ë¼ëŠ” ìƒíƒœ ë³€ìˆ˜ë¡œÂ `<í˜¼ìì»´í¬ë„ŒíŠ¸/>`ì™€Â `<ë‹¤ìˆ˜ì»´í¬ë„ŒíŠ¸/>`ë¥¼ ë¶„ê¸°ì²˜ë¦¬í•˜ì—¬ ë Œë”ë§í•˜ê³  ìˆë‹¤.
> 
> 3.  3ì¸ ì´ìƒì¼ë•Œ, íŠ¹ì • ì‚¬ìš©ìê°€ ì§„ì…í•˜ê±°ë‚˜ ë‚˜ê°”ì„ë•Œ,Â `<ë‹¤ìˆ˜ì»´í¬ë„ŒíŠ¸/>ì˜ ë¦¬ë Œë”ë§ì„ ë§‰ì„ìˆ˜ ìˆëŠ” ë°©ë²•ì€?`
> 

```jsx
const Comp = ( props ) => {
	return <div> { props.isAlone ? <span>í˜¼ì</span> : <span>ë‹¤ìˆ˜</span> } </div>
}
// React.memoê°€ Comp ì»´í¬ë„ŒíŠ¸ì˜ ì´ì „ê°’ê³¼ ì´í›„ê°’ì„ ë¹„êµí•´ì„œ ë¦¬ë Œë”ë§ ì—¬ë¶€ë¥¼ ê²°ì •í•œë‹¤.
const MemoizedComp = React.memo(Comp);

const App = () => {
  	const userList = useRecoilValue(userListAtom);
  	  
  	// useMemoê°€ userListì˜ ë³€í™”ë¥¼ ë©”ëª¨ì´ì œì´ì…˜í•´ì„œ isAloneì— ì ì ˆí•œ ê°’ì„ í• ë‹¹í•œë‹¤.
  	const isAlone = useMemo(() => {
    	if (userList.length === 1) return true;
      	else return false;
    }, [userList]);
    
	return (
    	<div>
        	{ userList.map(el => <Item {...el}/>) }
        	<Comp isAlone={isAlone} />
      	</div>
    )
}
```

1. `React.memo`ë¥¼ ì´ìš©í•´ `Comp` ì»´í¬ë„ŒíŠ¸ì˜ `props`ê°€ ë³€ê²½ë˜ì§€ ì•Šì•˜ì„ ë•Œ ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”ë§ ë°©ì§€
2. `useMemo`ë¥¼ ì´ìš©í•´, `userList` ê°’ì´ ë³€í•˜ì§€ ì•Šì•˜ì„ ë•Œ, `isAlone` ê°’ì˜ ì—…ë°ì´íŠ¸ ë°©ì§€

### âœ…Â ë” ë‚˜ì•„ê°€ì„œ,

<aside>
ğŸ’¡ `useMemo`ë¥¼ ì‚¬ìš©í•˜ëŠ”ê²ƒê³¼ `useState + useEffect`ëŠ” ì–´ë–¤ ì°¨ì´ê°€ ìˆì„ê¹Œ?

</aside>

- `useState + useEffect` ì—ì„œ ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”ë§ ë°œìƒ
- ì½”ë“œì˜ ê°€ë…ì„± ì¸¡ë©´ì—ì„œ `useMemo` í•˜ë‚˜ë¡œ ì²˜ë¦¬í•˜ëŠ” ê²Œ ë” ê¹”ë”

ì˜ˆì‹œ)

```tsx
const expensiveCalculator = (x) => x + 1;
const a = 1;

// 1. useMemo Case
const someNum = useMemo(() => {
		return expensiveCalculator(a);
},[expensiveCalculator])

// 2. useState + useEffect Case
const [someNum, setSomeNum] = useState(a);

useEffect(() => {
	setSomeNum(expensiveCalculator(a));
}, [expensiveCalculator]);

console.log(someNum);
```

1. `useMemo`ì—ì„œëŠ” ì¦‰ê°ì ìœ¼ë¡œ 2ê°€ ì¶œë ¥ëœë‹¤.
2. `useState + useEffect`ì—ì„œëŠ” ë¨¼ì € 1ì´ ì¶œë ¥ëœ ì´í›„ì— `useEffect` ì½œë°± í•¨ìˆ˜ ì—°ì‚°ì˜ ê²°ê³¼ì¸ 2ê°€ ì¶œë ¥ëœë‹¤.